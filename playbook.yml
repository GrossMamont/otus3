---
- hosts: all
  become: true
  vars:
    nginx_listen_port: 8080
  tasks: 
  - name: Updates apt cache
    apt:
      update_cache=yes
    tags: 
      - update apt

  - name: Install NGINX
    apt:
      name:
      - nginx
      state: latest
    notify:
      - restart nginx
    tags:
      - nginx-package

  - name: Create NGINX config
    template:
      src:  ./nginx.conf.j2
      dest: /etc/nginx/nginx.conf
    notify:
      - reload nginx
    tags:
      - nginx-configuration
      
  - name: Securing ports 80 and 443 (HTTP HTTPS)
    ufw:
      rule: allow
      port: 8080
      proto: tcp

  handlers:
    - name: restart nginx
      systemd:
        name: nginx
        state: restarted
        enabled: yes

    - name: reload nginx
      systemd:
        name: nginx
        state: reloaded